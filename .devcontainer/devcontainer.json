{
    "image": "mcr.microsoft.com/devcontainers/base:alpine",
    "features": {
        "ghcr.io/devcontainers/features/nix:1": {
            "multiUser": true,
            "version": "latest",
            // Needed for flakes & direnv:
            "extraNixConfig": "experimental-features = nix-command flakes,keep-outputs = true,keep-derivations = true"
        }
    },
    "onCreateCommand": {
        // Install, set up and allow direnv in workspace.
        "install-flakes": "nix profile install --accept-flake-config nixpkgs#devenv nixpkgs#direnv",
        "setup-direnv": "echo 'eval \"$(direnv hook bash)\"' >> ~/.bashrc && echo 'eval \"$(direnv hook zsh)\"' >> ~/.zshrc && mkdir -p ~/.config/fish && echo 'direnv hook fish | source' >> ~/.config/fish/config.fish && direnv allow"
    },
    "customizations": {
        "vscode": {
            "extensions": [
                // Inject direnv variables into VS Code terminals and tasks:
                "mkhl.direnv",
                // Support for `.nix` files:
                "jnoortheen.nix-ide"
            ]
        }
    }
}
